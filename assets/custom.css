/* Performance Optimizations - Phase 2 & 3: Image & Rendering Optimization */

/* Ensure single responsive image works across all devices */
.productitem--image-link {
  display: block;
  position: relative;
}

/* Remove any desktop/mobile specific image hiding that may exist */
.productitem--image.mobile {
  display: none !important;
}

.productitem--image-desktop {
  display: block !important;
}

/* Optimize image rendering */
.productitem--image img {
  display: block;
  width: 100%;
  height: auto;
}

/* Prevent layout shift with aspect ratio */
.productitem--image {
  position: relative;
  overflow: hidden;
}

/* Image loading optimization */
img[loading="lazy"] {
  content-visibility: auto;
}

/* Reduce paint complexity */
.productitem--image-primary,
.productitem--image-alternate {
  will-change: auto;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Optimize canvas elements for lazy loading */
[data-rimg-canvas] {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #f5f5f5;
  z-index: -1;
}

/* Additional Performance Optimizations */

/* Font rendering optimization */
body, html {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeSpeed;
}

/* Reduce repaints on scroll */
.site-header {
  will-change: auto;
  contain: layout style;
}

/* Optimize product grid rendering */
.productgrid {
  contain: layout style paint;
}

.productitem {
  contain: layout style;
}

/* Defer non-critical animations */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Optimize third-party iframe containers */
iframe {
  content-visibility: auto;
}

/* Reduce layout thrashing */
.modal, .drawer {
  contain: layout style;
}

/* Optimize badge rendering */
.productitem--badge,
.akta-badges {
  contain: layout style paint;
}

/* Improve scrolling performance */
* {
  -webkit-overflow-scrolling: touch;
}

/* Optimize form elements */
input, select, textarea, button {
  font: inherit;
}

/* Reduce complexity for animations */
@media (prefers-reduced-motion: no-preference) {
  .productitem--image-alternate {
    transition: opacity 0.2s ease;
  }
}

/* Optimize Hero Slideshow Images */
.slideshow-slide__image {
  max-width: 100%;
  height: auto;
  object-fit: cover;
  content-visibility: auto;
}

.slideshow-slide__image--desktop {
  display: block;
}

.slideshow-slide__image--mobile {
  display: none;
}

@media (max-width: 768px) {
  .slideshow-slide__image--desktop {
    display: none;
  }
  .slideshow-slide__image--mobile {
    display: block;
  }
}

/* Optimize Promo Mosaic Images */
.promo-block {
  background-size: cover !important;
  background-position: center !important;
  contain: layout style paint;
}

.promo-block--image {
  content-visibility: auto;
  will-change: auto;
}

/* Force image compression for large images */
.promo-mosaic--inner .promo-block[data-rimg-template] {
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
}

/* Optimize slideshow container */
.slideshow-slide {
  contain: layout style;
}

.slideshow-slide__background-link {
  display: block;
  position: relative;
}

.slideshow-slide__image-wrapper {
  position: relative;
  overflow: hidden;
  contain: layout style paint;
}

/* JavaScript Execution Optimization */
/* Reduce reflows and repaints during script execution */
.js-loading * {
  pointer-events: none;
}

/* Optimize third-party script containers */
[data-deferred="true"] {
  content-visibility: auto;
}

/* Reduce complexity during initial load */
body:not(.loaded) {
  contain: layout style;
}

/* Optimize heavy DOM elements */
.modal-wrapper,
.drawer-wrapper,
.quickshop-wrapper {
  content-visibility: auto;
  contain-intrinsic-size: 0 500px;
}

/* Defer non-visible content rendering */
.footer-content,
.site-footer-bottom {
  content-visibility: auto;
  contain-intrinsic-size: 0 300px;
}
