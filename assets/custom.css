/* Performance Optimizations - Phase 2 & 3: Image & Rendering Optimization */

/* Ensure single responsive image works across all devices */
.productitem--image-link {
  display: block;
  position: relative;
}

/* Remove any desktop/mobile specific image hiding that may exist */
.productitem--image.mobile {
  display: none !important;
}

.productitem--image-desktop {
  display: block !important;
}

/* Optimize image rendering */
.productitem--image img {
  display: block;
  width: 100%;
  height: auto;
}

/* Prevent layout shift with aspect ratio */
.productitem--image {
  position: relative;
  overflow: hidden;
}

/* Image loading optimization */
img[loading="lazy"] {
  content-visibility: auto;
}

/* Reduce paint complexity */
.productitem--image-primary,
.productitem--image-alternate {
  will-change: auto;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Optimize canvas elements for lazy loading */
[data-rimg-canvas] {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #f5f5f5;
  z-index: -1;
}

/* Additional Performance Optimizations */

/* Font rendering optimization */
body, html {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeSpeed;
}

/* Reduce repaints on scroll */
.site-header {
  will-change: auto;
  contain: layout style;
}

/* Optimize product grid rendering */
.productgrid {
  contain: layout style paint;
}

.productitem {
  contain: layout style;
}

/* Defer non-critical animations */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Optimize third-party iframe containers */
iframe {
  content-visibility: auto;
}

/* Reduce layout thrashing */
.modal, .drawer {
  contain: layout style;
}

/* Optimize badge rendering */
.productitem--badge,
.akta-badges {
  contain: layout style paint;
}

/* Improve scrolling performance */
* {
  -webkit-overflow-scrolling: touch;
}

/* Optimize form elements */
input, select, textarea, button {
  font: inherit;
}

/* Reduce complexity for animations */
@media (prefers-reduced-motion: no-preference) {
  .productitem--image-alternate {
    transition: opacity 0.2s ease;
  }
}

/* Optimize Hero Slideshow Images */
.slideshow-slide__image {
  max-width: 100%;
  height: auto;
  object-fit: cover;
  content-visibility: auto;
}

.slideshow-slide__image--desktop {
  display: block;
}

.slideshow-slide__image--mobile {
  display: none;
}

@media (max-width: 768px) {
  .slideshow-slide__image--desktop {
    display: none;
  }
  .slideshow-slide__image--mobile {
    display: block;
  }
}

/* Optimize Promo Mosaic Images */
.promo-block {
  background-size: cover !important;
  background-position: center !important;
  contain: layout style paint;
}

.promo-block--image {
  content-visibility: auto;
  will-change: auto;
}

/* Force image compression for large images */
.promo-mosaic--inner .promo-block[data-rimg-template] {
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
}

/* Optimize slideshow container */
.slideshow-slide {
  contain: layout style;
}

.slideshow-slide__background-link {
  display: block;
  position: relative;
}

.slideshow-slide__image-wrapper {
  position: relative;
  overflow: hidden;
  contain: layout style paint;
}

/* JavaScript Execution Optimization */
/* Reduce reflows and repaints during script execution */
.js-loading * {
  pointer-events: none;
}

/* Optimize third-party script containers */
[data-deferred="true"] {
  content-visibility: auto;
}

/* Reduce complexity during initial load */
body:not(.loaded) {
  contain: layout style;
}

/* Optimize heavy DOM elements */
.modal-wrapper,
.drawer-wrapper,
.quickshop-wrapper {
  content-visibility: auto;
  contain-intrinsic-size: 0 500px;
}

/* Defer non-visible content rendering */
.footer-content,
.site-footer-bottom {
  content-visibility: auto;
  contain-intrinsic-size: 0 300px;
}

/* Aggressive Style & Layout Optimization (683ms reduction) */
/* Reduce layout thrashing with strict containment */
.site-header,
.site-header-main,
.site-nav,
.site-nav-dropdown {
  contain: layout style paint;
}

.productgrid--outer,
.collection-main {
  contain: layout style paint;
}

.productitem,
.productitem--outer {
  contain: layout style paint;
  content-visibility: auto;
  contain-intrinsic-size: 0 400px;
}

/* Optimize product images for faster rendering */
.productitem--image,
.productitem--image-link {
  contain: layout style paint;
}

/* Reduce reflow triggers */
* {
  box-sizing: border-box;
}

/* Optimize animations to use GPU */
@media (prefers-reduced-motion: no-preference) {
  .productitem--image-alternate,
  .modal,
  .drawer,
  .quickshop {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }
}

/* Minimize paint areas */
.site-footer,
.site-footer-main,
.footer-block {
  contain: layout style paint;
  content-visibility: auto;
  contain-intrinsic-size: 0 200px;
}

/* Optimize form elements to reduce layout */
input,
select,
textarea,
button {
  contain: layout style;
}

/* Reduce rendering complexity */
.modal-wrapper,
.drawer-wrapper,
.quickshop-wrapper,
.cart-drawer {
  contain: layout style paint;
  will-change: auto;
}

/* Optimize badge rendering */
.productitem--badge,
.product-badge,
.akta-badges,
.badge {
  contain: layout style paint;
  transform: translateZ(0);
}

/* Reduce garbage collection with efficient selectors */
[data-section-type],
[data-section-id] {
  contain: layout style;
}

/* Optimize third-party containers */
[id*="limespot"],
[id*="plerdy"],
[id*="autoketing"],
[class*="smile-"] {
  content-visibility: auto;
  contain: layout style paint;
}

/* Mobile-Specific Optimizations */
@media (max-width: 768px) {
  /* Aggressive mobile image optimization */
  .slideshow-slide__image--mobile {
    max-width: 100%;
    height: auto;
    image-rendering: -webkit-optimize-contrast;
  }
  
  /* Optimize mobile logo */
  .site-logo-image {
    max-width: 200px;
    height: auto;
  }
  
  /* Reduce mobile layout complexity - AGGRESSIVE */
  .productgrid {
    contain: strict;
  }
  
  .productitem {
    contain: strict;
    content-visibility: auto;
    contain-intrinsic-size: 0 320px;
  }
  
  /* Mobile header optimization - REMOVED strict containment to fix display */
  .site-header {
    will-change: auto;
  }
  
  /* Reduce mobile footer complexity */
  .site-footer {
    contain: strict;
    content-visibility: auto;
    contain-intrinsic-size: 0 200px;
  }
  
  /* Mobile image lazy loading optimization */
  img[loading="lazy"] {
    content-visibility: auto;
    contain-intrinsic-size: 0 180px;
  }
  
  /* Optimize mobile modals */
  .modal,
  .drawer,
  .quickshop {
    contain: strict;
    transform: translateZ(0);
  }
  
  /* Mobile GPU acceleration - AGGRESSIVE */
  .productitem--image-alternate,
  .slideshow-slide {
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    will-change: transform;
  }
  
  /* Reduce mobile rendering complexity */
  .productitem--image,
  .productitem--image-link {
    contain: strict;
    transform: translateZ(0);
  }
  
  /* Mobile-specific style optimization */
  * {
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Reduce mobile paint complexity */
  .site-nav,
  .site-nav-dropdown,
  .site-nav-item {
    contain: layout style;
  }
  
  /* Mobile form optimization */
  input,
  select,
  textarea,
  button {
    contain: strict;
  }
  
  /* Optimize mobile animations - reduce to essentials */
  * {
    animation-duration: 0.2s !important;
    transition-duration: 0.2s !important;
  }
  
  /* Mobile badge optimization */
  .productitem--badge,
  .product-badge,
  .badge {
    contain: strict;
    transform: translateZ(0);
  }
  
  /* Mobile third-party optimization */
  [id*="limespot"],
  [id*="plerdy"],
  [id*="autoketing"],
  [class*="smile-"] {
    content-visibility: auto;
    contain: strict;
    contain-intrinsic-size: 0 100px;
  }
  
  /* Reduce mobile scroll complexity */
  .scrollable,
  .overflow-scroll {
    -webkit-overflow-scrolling: touch;
    contain: layout style;
  }
  
  /* Mobile collection/grid optimization */
  .collection-main,
  .productgrid--outer {
    contain: strict;
  }
  
  /* Optimize mobile text rendering */
  body,
  p,
  h1, h2, h3, h4, h5, h6 {
    text-rendering: optimizeSpeed;
  }
}
